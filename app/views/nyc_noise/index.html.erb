<!--  <div id="panel"> -->
<!--   <button onclick="toggleHeatmap()">Toggle Heatmap</button> -->
<!--   <button onclick="changeGradient()">Change gradient</button> -->
<!--   <button onclick="changeRadius()">Change radius</button> -->
<!--   <button onclick="changeOpacity()">Change opacity</button> -->
<!-- </div>  -->

<div class="container">
  <label for="hour" style="font-size:16pt;">Time of day (in hourly increments):</label>
  <input type="text" id="hour" readonly style="border:0; color:#f6931f; font-size:18pt; font-weight:bold;">
</div>
 
<div id="slider"></div>


<div id="map-canvas"></div>

<script>
  google.maps.event.addDomListener(window, 'load', initialize);

  var map, pointarray, heatmap;
  var noiseData;

  function createData() {
    noiseData = [
    <% @noise_complaints.each do |noise_complaint| %>
      new google.maps.LatLng(<%= noise_complaint.latitude.to_f %>, <%= noise_complaint.longitude.to_f %>),
    <% end %>
    ];
  }

  function initialize() {
    createData();

    var styling = [{"featureType":"water","elementType":"geometry","stylers":[{"color":"#e9e9e9"},{"lightness":17}]},{"featureType":"landscape","elementType":"geometry","stylers":[{"color":"#f5f5f5"},{"lightness":20}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#ffffff"},{"lightness":17}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#ffffff"},{"lightness":29},{"weight":0.2}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#ffffff"},{"lightness":18}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#ffffff"},{"lightness":16}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#f5f5f5"},{"lightness":21}]},{"featureType":"poi.park","elementType":"geometry","stylers":[{"color":"#dedede"},{"lightness":21}]},{"elementType":"labels.text.stroke","stylers":[{"visibility":"on"},{"color":"#ffffff"},{"lightness":16}]},{"elementType":"labels.text.fill","stylers":[{"saturation":36},{"color":"#333333"},{"lightness":40}]},{"elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"geometry","stylers":[{"color":"#f2f2f2"},{"lightness":19}]},{"featureType":"administrative","elementType":"geometry.fill","stylers":[{"color":"#fefefe"},{"lightness":20}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#fefefe"},{"lightness":17},{"weight":1.2}]}]

     var my_gradient = [
      'rgba(66, 63, 190,1)',
      'rgba(80, 62, 177, 1)',
      'rgba(94, 62, 165, 1)',
      'rgba(107, 61, 152, 1)',
      'rgba(121, 61, 140, 1)',
      'rgba(135, 60, 127, 1)',
      'rgba(148, 59, 114, 1)',
      'rgba(162, 59, 102, 1)',
      'rgba(176, 58, 89, 1)',
      'rgba(190, 58, 77, 1)',
      'rgba(203, 57, 64, 1)',
      'rgba(217, 57, 52, 1)',
      'rgba(217, 57, 52, 1)',
      'rgba(231, 56, 39, 1)'
    ]
   

    var mapOptions = {
      zoom: 11,
      radius: 100,
      opacity: 1,
      styles: styling,
      maxIntensity: 1000,
      center: new google.maps.LatLng(40.7731295,-73.957734),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);

    var pointArray = new google.maps.MVCArray(noiseData);

    heatmap = new google.maps.visualization.HeatmapLayer({
      data: pointArray,
      // gradient: my_gradient,
      opacity: .9,
      radius: 25,
    });

    heatmap.setMap(map);
  }

  function toggleHeatmap() {
    heatmap.setMap(heatmap.getMap() ? null : map);
  }


  // function changeRadius() {
  //   heatmap.set('radius', heatmap.get('radius') ? null : 20);
  // }

  // function changeOpacity() {
  //   heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
  // }

  $( "#slider" ).on( "slidechange", function( event, ui ) {
    $.ajax({
      url: '/'+ui.value,
      method: 'get',
      success: function(data){
        var newNoiseData = []
        data.forEach(function(dataPoint){
          newNoiseData.push(new google.maps.LatLng(dataPoint.latitude,dataPoint.longitude))
        });

        var pointArray = new google.maps.MVCArray(newNoiseData);

        heatmap.setMap(null)

        heatmap = new google.maps.visualization.HeatmapLayer({
          data: pointArray
        });

        heatmap.setMap(map);

      }
    });

  });

</script>
